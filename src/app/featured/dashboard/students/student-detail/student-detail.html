<div class="main-card">
  <mat-toolbar color="primary">
    <span>Detalle de Chófer - {{ studentName }}</span>
  </mat-toolbar>

  <div class="toolbar-row">
    <button mat-icon-button (click)="prevMonth()" aria-label="Anterior mes"><mat-icon>chevron_left</mat-icon></button>

    <mat-form-field appearance="fill" class="month-select">
      <mat-select [value]="selectedMonthIndex" (selectionChange)="setMonth($event.value)">
        <mat-option *ngFor="let m of months; let i = index" [value]="i">{{ m }}</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-icon-button (click)="nextMonth()" aria-label="Siguiente mes"><mat-icon>chevron_right</mat-icon></button>

    <div class="summary">Promedio comisión: <strong>{{ averageCommission | number:'1.2-2' }}</strong></div>
  </div>

  <div class="table-wrapper">
    <table class="detail-table">
      <thead>
        <tr>
          <th>Día</th>
          <th>Horas</th>
          <th>Detalle</th>
          <th>Venta</th>
          <th>Comisión chofer</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of days">
          <td>{{ row.day }}</td>
          <td><input type="number" [value]="row.hours" (change)="updateRow(row, 'hours', $any($event.target).value)" /></td>
          <td><input type="text" [value]="row.detail" (change)="updateRow(row, 'detail', $any($event.target).value)" /></td>
          <td><input type="number" [value]="row.sale" (change)="updateRow(row, 'sale', $any($event.target).value)" /></td>
          <td class="commission-cell">
            <input type="number" [value]="(row.commissionOverride !== null && row.commissionOverride !== undefined) ? row.commissionOverride : ({ hours: row.hours, sale: row.sale } | commission)" (change)="updateCommission(row, $any($event.target).value)" />
            <button mat-icon-button title="Auto" (click)="resetCommission(row)"><mat-icon>autorenew</mat-icon></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
